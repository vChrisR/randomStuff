#!/bin/bash

INSTALLDIR="/weblogic/app/wls12c"
INVPTR="/etc/oraInst.loc"
SILENT_RSP="/tmp/silent.rsp"

#Create group and user
/usr/sbin/groupadd $wlgroup -g $wlgroup_gid
/usr/sbin/useradd $wluser -g $wlgroup_gid -u $wluser_uid

#Set TCP and UDP parameters

#/usr/sbin/ndd -set /dev/tcp tcp_time_wait_interval 30000
#/usr/sbin/ndd -set /dev/tcp tcp_ip_abort_interval 60000
#/usr/sbin/ndd -set /dev/tcp tcp_conn_req_max_q 102400
#/usr/sbin/ndd -set /dev/tcp tcp_conn_req_max_q0 102400
#/usr/sbin/ndd -set /dev/tcp tcp_max_buf 4194304
#/usr/sbin/ndd -set /dev/tcp tcp_cwnd_max 2097152
#/usr/sbin/ndd -set /dev/tcp tcp_recv_hiwat 400000
#/usr/sbin/ndd -set /dev/tcp tcp_xmit_hiwat 400000
#/usr/sbin/ndd -set /dev/tcp tcp_keepalive_interval 15000
#/usr/sbin/ndd -set /dev/tcp tcp_fin_wait_2_flush_interval 57000
#/usr/sbin/ndd -set /dev/tcp tcp_slow_start_initial 4
#/usr/sbin/ndd -set /dev/udp udp_xmit_hiwat 65536
#/usr/sbin/ndd -set /dev/udp udp_recv_hiwat 65536

#set limits
#echo $wluser soft nofile        50240 >> /etc/security/limits.conf
#echo $wluser hard nofile        600636 >> /etc/security/limits.conf
#echo $wluser soft nproc         36000 >> /etc/security/limits.conf
#echo $wluser hard nproc         65000  >> /etc/security/limits.conf
#echo $wluser soft stack         40480 >> /etc/security/limits.conf
#echo $wluser hard stack         65536 >> /etc/security/limits.conf

#create ora inventory directory
mkdir /etc/oraInst
chown root:$wlgroup /etc/oraInst
chmod g+rwx /etc/oraInst

#Create oracle inventory pointer file
cat <<EOF> $INVPTR
inventory_loc=/etc/oraInst
inst_group=$wlgroup
EOF

#set permissions on weblogic dir
#chown $wlsuser:$wlsgroup /weblogic

#create response file
cat <<EOF> $SILENT_RSP
[ENGINE]
#DO NOT CHANGE THIS.
Response File Version=1.0.0.0.0
[GENERIC]
#The oracle home location. This can be an existing Oracle Home or a new Oracle Home
ORACLE_HOME=$INSTALLDIR
#Set this variable value to the Installation Type selected. e.g. WebLogic Server, Coherence, Complete with Examples.
INSTALL_TYPE=WebLogic Server
#Provide the My Oracle Support Username. If you wish to ignore Oracle Configuration Manager configuration provide empty string for user name.
MYORACLESUPPORT_USERNAME=
#Provide the My Oracle Support Password
MYORACLESUPPORT_PASSWORD=<SECURE VALUE>
#Set this to true if you wish to decline the security updates. Setting this to true and providing empty string for My Oracle Support username will ignore the Oracle Configuration Manager configuration
DECLINE_SECURITY_UPDATES=true
#Set this to true if My Oracle Support Password is specified
SECURITY_UPDATES_VIA_MYORACLESUPPORT=false
#Provide the Proxy Host
PROXY_HOST=
#Provide the Proxy Port
PROXY_PORT=
#Provide the Proxy Username
PROXY_USER=
#Provide the Proxy Password
PROXY_PWD=<SECURE VALUE>
#Type String (URL format) Indicates the OCM Repeater URL which should be of the format [scheme[Http/Https]]://[repeater host]:[repeater port]
COLLECTOR_SUPPORTHUB_URL=
EOF

#run WL installer
su - $wluser <<EOF
mkdir -p $INSTALLDIR
/opt/jdk1.7.0_79/bin/java -jar $wlinstaller -silent -responseFile $SILENT_RSP -invPtrLoc $INVPTR
EOF
